<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Freeview - Image Gallery</title>
    <link rel="stylesheet" href="style.css">
    <!-- PWA Meta Tags -->
    <meta name="description" content="A local image gallery viewer with lightbox, zoom, and touch support">
    <meta name="theme-color" content="#333333">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Freeview">
    <meta name="mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" sizes="152x152" href="icons/icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="icons/icon-16x16.png">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <aside id="sidebar">
        <div id="sidebar-header">
            <h2>Freeview</h2>
            <input type="file" id="folderInput" webkitdirectory multiple hidden>
            <label for="folderInput" class="folder-input-label">Choose Folder</label>
        </div>
        <div id="sidebar-folders">
            <!-- Folder list will be populated here by JS -->
            <a href="#" class="sidebar-item active">
                <span class="sidebar-icon">ðŸ—€</span>
                <div class="sidebar-text-content">
                    <span class="sidebar-title">All Files</span>
                    <span class="sidebar-subtitle">All your images</span>
                </div>
            </a>
        </div>
        <div id="sidebar-resizer"></div>
    </aside>

    <main id="main-content">
        <header id="main-header">
            <h1 id="current-folder-title">All Files</h1>
        </header>

        <div class="toolbar">
            <span id="connectedFolderInfo">Connected to: All Files</span>
            <div class="header-controls">
                <select id="sortSelect">
                    <option value="newest">Newest â†’ Oldest</option>
                    <option value="oldest">Oldest â†’ Newest</option>
                    <option value="name-asc">Name A â†’ Z</option>
                    <option value="name-desc">Name Z â†’ A</option>
                    <option value="size-asc">Size: Small â†’ Large</option>
                    <option value="size-desc">Size: Large â†’ Small</option>
                </select>
                <button id="clearBtn">Clear</button>
                <div id="loading"></div>
            </div>
        </div>

        <div id="gallery">
            <!-- Images will be loaded here -->
        </div>

        <footer id="status-bar">
            <span id="itemCount">0 Items</span>
            <div class="slider-container">
                
                <input type="range" id="thumbnailSizeSlider" min="100" max="300" value="200" step="10">
            </div>
        </footer>
    </main>

    <!-- Lightbox -->
    <div id="lightbox">
        <div class="arrow left">&#10094;</div>
        <img src="" alt="Lightbox Image">
        <div class="arrow right">&#10095;</div>
        <div id="miniControls">
            <canvas id="miniMap"></canvas>
            <input type="range" id="lightboxZoomSlider" min="0.5" max="5" step="0.01" value="1">
        </div>
    </div>

    <script src="gallery.js" defer></script>
    <!-- PWA Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    if (confirm('New version available! Reload to update?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch(error => {
                        console.log('SW registration failed: ', error);
                    });
            });
        }
    </script>
</body>
</html>